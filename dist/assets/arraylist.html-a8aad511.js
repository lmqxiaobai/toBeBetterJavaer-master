import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,a as n,d as a,b as e,e as t}from"./app-1c5b5ce3.js";const l={},u=t(`<h1 id="_6-3-arraylist详解-附源码" tabindex="-1"><a class="header-anchor" href="#_6-3-arraylist详解-附源码" aria-hidden="true">#</a> 6.3 ArrayList详解（附源码）</h1><p>“二哥，听说今天我们开讲 ArrayList 了？好期待哦！”三妹明知故问，这个托配合得依然天衣无缝。</p><p>“是的呀，三妹。”我肯定地点了点头，继续说道，“ArrayList 可以称得上是集合框架方面最常用的类了，可以和 HashMap 一较高下。”</p><p>从名字就可以看得出来，ArrayList 实现了 List 接口，并且是基于数组实现的。</p><p>数组的大小是固定的，一旦创建的时候指定了大小，就不能再调整了。也就是说，如果数组满了，就不能再添加任何元素了。ArrayList 在数组的基础上实现了自动扩容，并且提供了比数组更丰富的预定义方法（各种增删改查），非常灵活。</p><p>Java 这门编程语言和别的编程语言，比如说 C语言的不同之处就在这里，如果是 C语言的话，你就必须得动手实现自己的 ArrayList，原生的库函数里面是没有的。</p><h3 id="_01、创建-arraylist" tabindex="-1"><a class="header-anchor" href="#_01、创建-arraylist" aria-hidden="true">#</a> 01、创建 ArrayList</h3><p>“二哥，<strong>如何创建一个 ArrayList 啊</strong>？”三妹问。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> alist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以通过上面的语句来创建一个字符串类型的 ArrayList（通过尖括号来限定 ArrayList 中元素的类型，如果尝试添加其他类型的元素，将会产生编译错误），更简化的写法如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> alist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>由于 ArrayList 实现了 List 接口，所以 alist 变量的类型可以是 List 类型；new 关键字声明后的尖括号中可以不再指定元素的类型，因为编译器可以通过前面尖括号中的类型进行智能推断。</p><p>此时会调用无参构造方法（见下面的代码）创建一个空的数组，常量DEFAULTCAPACITY_EMPTY_ELEMENTDATA的值为 <code>{}</code>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果非常确定 ArrayList 中元素的个数，在创建的时候还可以指定初始大小。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> alist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样做的好处是，可以有效地避免在添加新的元素时进行不必要的扩容。</p><h3 id="_02、向-arraylist-中添加元素" tabindex="-1"><a class="header-anchor" href="#_02、向-arraylist-中添加元素" aria-hidden="true">#</a> 02、向 ArrayList 中添加元素</h3><p>“二哥，<strong>那怎么向 ArrayList 中添加一个元素呢</strong>？”三妹继续问。</p><p>可以通过 <code>add()</code> 方法向 ArrayList 中添加一个元素。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>alist<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;沉默王二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们来跟一下源码，看看 add 方法到底执行了哪些操作。跟的过程中，我们也可以偷师到 Java 源码的作者（大师级程序员）是如何优雅地写代码的。</p><p>我先给个结论，全当抛砖引玉。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>堆栈过程图示：
add(element)
└── if (size == elementData.length) // 判断是否需要扩容
    ├── grow(minCapacity) // 扩容
    │   └── newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1) // 计算新的数组容量
    │   └── Arrays.copyOf(elementData, newCapacity) // 创建新的数组
    ├── elementData[size++] = element; // 添加新元素
    └── return true; // 添加成功
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>来具体看一下，先是 <code>add()</code> 方法的源码（已添加好详细地注释）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 将指定元素添加到 ArrayList 的末尾
 * <span class="token keyword">@param</span> <span class="token parameter">e</span> 要添加的元素
 * <span class="token keyword">@return</span> 添加成功返回 true
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 确保 ArrayList 能够容纳新的元素</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span> <span class="token comment">// 在 ArrayList 的末尾添加指定元素</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数 e 为要添加的元素，此时的值为“沉默王二”，size 为 ArrayList 的长度，此时为 0。</p><p>继续跟下去，来看看 <code>ensureCapacityInternal()</code>方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 确保 ArrayList 能够容纳指定容量的元素
 * <span class="token keyword">@param</span> <span class="token parameter">minCapacity</span> 指定容量的最小值
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData <span class="token operator">==</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果 elementData 还是默认的空数组</span>
        minCapacity <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 DEFAULT_CAPACITY 和指定容量的最小值中的较大值</span>
    <span class="token punctuation">}</span>

    <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 确保容量能够容纳指定容量的元素</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时：</p><ul><li>参数 minCapacity 为 1（size+1 传过来的）</li><li>elementData 为存放 ArrayList 元素的底层数组，前面声明 ArrayList 的时候讲过了，此时为空 <code>{}</code></li><li>DEFAULTCAPACITY_EMPTY_ELEMENTDATA 前面也讲过了，为 <code>{}</code></li></ul><p>所以，if 条件此时为 true，if 语句<code>minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity)</code>要执行。</p><p>DEFAULT_CAPACITY 为 10（见下面的代码），所以执行完这行代码后，minCapacity 为 10，<code>Math.max()</code> 方法的作用是取两个当中最大的那个。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_CAPACITY</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>接下来执行 <code>ensureExplicitCapacity()</code> 方法，来看一下源码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 检查并确保集合容量足够，如果需要则增加集合容量。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">minCapacity</span> 所需最小容量
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 检查是否超出了数组范围，确保不会溢出</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">-</span> elementData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// 如果需要增加容量，则调用 grow 方法</span>
        <span class="token function">grow</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时：</p><ul><li>参数 minCapacity 为 10</li><li>elementData.length 为 0（数组为空）</li></ul><p>所以 10-0&gt;0，if 条件为 true，进入 if 语句执行 <code>grow()</code> 方法，来看源码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 扩容 ArrayList 的方法，确保能够容纳指定容量的元素
 * <span class="token keyword">@param</span> <span class="token parameter">minCapacity</span> 指定容量的最小值
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 检查是否会导致溢出，oldCapacity 为当前数组长度</span>
    <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扩容至原来的1.5倍</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 如果还是小于指定容量的最小值</span>
        newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span> <span class="token comment">// 直接扩容至指定容量的最小值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> <span class="token constant">MAX_ARRAY_SIZE</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 如果超出了数组的最大长度</span>
        newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扩容至数组的最大长度</span>
    <span class="token comment">// 将当前数组复制到一个新数组中，长度为 newCapacity</span>
    elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时：</p><ul><li>参数 minCapacity 为 10</li><li>变量 oldCapacity 为 0</li></ul><p>所以 newCapacity 也为 0，于是 <code>newCapacity - minCapacity</code> 等于 -10 小于 0，于是第一个 if 条件为 true，执行第一个 if 语句 <code>newCapacity = minCapacity</code>，然后 newCapacity 为 10。</p><p>紧接着执行 <code>elementData = Arrays.copyOf(elementData, newCapacity);</code>，也就是进行数组的第一次扩容，长度为 10。</p><p>回到 <code>add()</code> 方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行 <code>elementData[size++] = e</code>。</p><p>此时：</p><ul><li>size 为 0</li><li>e 为 “沉默王二”</li></ul><p>所以数组的第一个元素（下标为 0） 被赋值为“沉默王二”，接着返回 true，第一次 add 方法执行完毕。</p><p>PS：add 过程中会遇到一个令新手感到困惑的右移操作符 <code>&gt;&gt;</code>，借这个机会来解释一下。</p><p>ArrayList 在第一次执行 add 后会扩容为 10，那 ArrayList 第二次扩容发生在什么时候呢？</p><p>答案是添加第 11 个元素时，大家可以尝试分析一下这个过程。</p><h3 id="_03、右移操作符" tabindex="-1"><a class="header-anchor" href="#_03、右移操作符" aria-hidden="true">#</a> 03、右移操作符</h3><p>“oldCapacity 等于 10，<code>oldCapacity &gt;&gt; 1</code> 这个表达式等于多少呢？三妹你知道吗？”我问三妹。</p><p>“不知道啊，<code>&gt;&gt;</code> 是什么意思呢？”三妹很疑惑。</p><p>“<code>&gt;&gt;</code> 是右移运算符，<code>oldCapacity &gt;&gt; 1</code> 相当于 oldCapacity 除以 2。”我给三妹解释道，“在计算机内部，都是按照二进制存储的，10 的二进制就是 1010，也就是 <code>0*2^0 + 1*2^1 + 0*2^2 + 1*2^3</code>=0+2+0+8=10 。。。。。。”</p><p>还没等我解释完，三妹就打断了我，“二哥，能再详细解释一下到底为什么吗？”</p><p>“当然可以啊。”我拍着胸脯对三妹说。</p><p>先从位权的含义说起吧。</p><p>平常我们使用的是十进制数，比如说 39，并不是简单的 3 和 9，3 表示的是 <code>3*10 = 30</code>，9 表示的是 <code>9*1 = 9</code>，和 3 相乘的 10，和 9 相乘的 1，就是<strong>位权</strong>。位数不同，位权就不同，第 1 位是 10 的 0 次方（也就是 <code>10^0=1</code>），第 2 位是 10 的 1 次方（<code>10^1=10</code>），第 3 位是 10 的 2 次方（<code>10^2=100</code>），最右边的是第一位，依次类推。</p><p>位权这个概念同样适用于二进制，第 1 位是 2 的 0 次方（也就是 <code>2^0=1</code>），第 2 位是 2 的 1 次方（<code>2^1=2</code>），第 3 位是 2 的 2 次方（<code>2^2=4</code>），第 34 位是 2 的 3 次方（<code>2^3=8</code>）。</p><p>十进制的情况下，10 是基数，二进制的情况下，2 是基数。</p><p>10 在十进制的表示法是 <code>0*10^0+1*10^1</code>=0+10=10。</p><p>10 的二进制数是 1010，也就是 <code>0*2^0 + 1*2^1 + 0*2^2 + 1*2^3</code>=0+2+0+8=10。</p><p>然后是<strong>移位运算</strong>，移位分为左移和右移，在 Java 中，左移的运算符是 <code>&lt;&lt;</code>，右移的运算符 <code>&gt;&gt;</code>。</p><p>拿 <code>oldCapacity &gt;&gt; 1</code> 来说吧，<code>&gt;&gt;</code> 左边的是被移位的值，此时是 10，也就是二进制 <code>1010</code>；<code>&gt;&gt;</code> 右边的是要移位的位数，此时是 1。</p><p>1010 向右移一位就是 101，空出来的最高位此时要补 0，也就是 0101。</p><p>“那为什么不补 1 呢？”三妹这个问题很尖锐。</p><p>“因为是算术右移，并且是正数，所以最高位补 0；如果表示的是负数，就需要补 1。”我慢吞吞地回答道，“0101 的十进制就刚好是 <code>1*2^0 + 0*2^1 + 1*2^2 + 0*2^3</code>=1+0+4+0=5，如果多移几个数来找规律的话，就会发现，右移 1 位是原来的 1/2，右移 2 位是原来的 1/4，诸如此类。”</p><p>也就是说，ArrayList 的大小会扩容为原来的大小+原来大小/2，也就是 1.5 倍。</p><p>这下明白了吧？</p><p>你可以通过在 ArrayList 中添加第 11 个元素来 debug 验证一下。</p><figure><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection//arraylist-d01f248c-114f-47e3-af18-7135feac2a5e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_04、向-arraylist-的指定位置添加元素" tabindex="-1"><a class="header-anchor" href="#_04、向-arraylist-的指定位置添加元素" aria-hidden="true">#</a> 04、向 ArrayList 的指定位置添加元素</h3><p>除了 <code>add(E e)</code> 方法，还可以通过 <code>add(int index, E element)</code> 方法把元素添加到 ArrayList 的指定位置：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>alist<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;沉默王三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>add(int index, E element)</code> 方法的源码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 在指定位置插入一个元素。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span>   要插入元素的位置
 * <span class="token keyword">@param</span> <span class="token parameter">element</span> 要插入的元素
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IndexOutOfBoundsException</span></span> 如果索引超出范围，则抛出此异常
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rangeCheckForAdd</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查索引是否越界</span>

    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 确保容量足够，如果需要扩容就扩容</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
            size <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 index 及其后面的元素向后移动一位</span>
    elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span> <span class="token comment">// 将元素插入到指定位置</span>
    size<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 元素个数加一</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,79),d=n("code",null,"add(int index, E element)",-1),r={href:"https://javabetter.cn/oo/native-method.html",target:"_blank",rel:"noopener noreferrer"},k=n("code",null,"System.arraycopy()",-1),m=t(`<p>来细品一下。</p><p>这是 arraycopy() 的语法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> srcPos<span class="token punctuation">,</span> <span class="token class-name">Object</span> dest<span class="token punctuation">,</span> <span class="token keyword">int</span> destPos<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在 <code>ArrayList.add(int index, E element)</code> 方法中，具体用法如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> size <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>elementData：表示要复制的源数组，即 ArrayList 中的元素数组。</li><li>index：表示源数组中要复制的起始位置，即需要将 index 及其后面的元素向后移动一位。</li><li>elementData：表示要复制到的目标数组，即 ArrayList 中的元素数组。</li><li>index + 1：表示目标数组中复制的起始位置，即将 index 及其后面的元素向后移动一位后，应该插入到的位置。</li><li>size - index：表示要复制的元素个数，即需要将 index 及其后面的元素向后移动一位，需要移动的元素个数为 size - index。</li></ul><p>“三妹，注意看，我画幅图来表示下。”我认真地做起了图。</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraylist-01.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_05、更新-arraylist-中的元素" tabindex="-1"><a class="header-anchor" href="#_05、更新-arraylist-中的元素" aria-hidden="true">#</a> 05、更新 ArrayList 中的元素</h3><p>“二哥，那怎么<strong>更新 ArrayList 中的元素</strong>呢？”三妹继续问。</p><p>可以使用 <code>set()</code> 方法来更改 ArrayList 中的元素，需要提供下标和新元素。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>alist<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;沉默王四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>假设原来 0 位置上的元素为“沉默王三”，现在可以将其更新为“沉默王四”。</p><p>来看一下 <code>set()</code> 方法的源码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 用指定元素替换指定位置的元素。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span>   要替换的元素的索引
 * <span class="token keyword">@param</span> <span class="token parameter">element</span> 要存储在指定位置的元素
 * <span class="token keyword">@return</span> 先前在指定位置的元素
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IndexOutOfBoundsException</span></span> 如果索引超出范围，则抛出此异常
 */</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查索引是否越界</span>

    <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取原来在指定位置上的元素</span>
    elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span> <span class="token comment">// 将新元素替换到指定位置上</span>
    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span> <span class="token comment">// 返回原来在指定位置上的元素</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该方法会先对指定的下标进行检查，看是否越界，然后替换新值并返回旧值。</p><h3 id="_06、删除-arraylist-中的元素" tabindex="-1"><a class="header-anchor" href="#_06、删除-arraylist-中的元素" aria-hidden="true">#</a> 06、删除 ArrayList 中的元素</h3><p>“二哥，那怎么<strong>删除 ArrayList 中的元素</strong>呢？”三妹继续问。</p><p><code>remove(int index)</code> 方法用于删除指定下标位置上的元素，<code>remove(Object o)</code> 方法用于删除指定值的元素。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>alist<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
alist<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;沉默王四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>先来看 <code>remove(int index)</code> 方法的源码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 删除指定位置的元素。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> 要删除的元素的索引
 * <span class="token keyword">@return</span> 先前在指定位置的元素
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IndexOutOfBoundsException</span></span> 如果索引超出范围，则抛出此异常
 */</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查索引是否越界</span>

    <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取要删除的元素</span>

    <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 计算需要移动的元素个数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 如果需要移动元素，就用 System.arraycopy 方法实现</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 将数组末尾的元素置为 null，让 GC 回收该元素占用的空间</span>

    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span> <span class="token comment">// 返回被删除的元素</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意的是，在 ArrayList 中，删除元素时，需要将删除位置后面的元素向前移动一位，以填补删除位置留下的空缺。如果需要移动元素，则需要使用 System.arraycopy 方法将删除位置后面的元素向前移动一位。最后，将数组末尾的元素置为 null，以便让垃圾回收机制回收该元素占用的空间。</p><p>再来看 <code>remove(Object o)</code> 方法的源码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 删除列表中第一次出现的指定元素（如果存在）。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">o</span> 要删除的元素
 * <span class="token keyword">@return</span> 如果列表包含指定元素，则返回 true；否则返回 false
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果要删除的元素是 null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 遍历列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果找到了 null 元素</span>
                <span class="token function">fastRemove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 fastRemove 方法快速删除元素</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 返回 true，表示成功删除元素</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 如果要删除的元素不是 null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 遍历列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果找到了要删除的元素</span>
                <span class="token function">fastRemove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 fastRemove 方法快速删除元素</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 返回 true，表示成功删除元素</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 如果找不到要删除的元素，则返回 false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该方法通过遍历的方式找到要删除的元素，null 的时候使用 == 操作符判断，非 null 的时候使用 <code>equals()</code> 方法，然后调用 <code>fastRemove()</code> 方法。</p><p>注意：</p>`,27),v=n("li",null,"有相同元素时，只会删除第一个。",-1),b={href:"https://javabetter.cn/string/equals.html",target:"_blank",rel:"noopener noreferrer"},y=t(`<p>继续往后面跟，来看一下 <code>fastRemove()</code> 方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 快速删除指定位置的元素。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> 要删除的元素的索引
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fastRemove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 计算需要移动的元素个数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 如果需要移动元素，就用 System.arraycopy 方法实现</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 将数组末尾的元素置为 null，让 GC 回收该元素占用的空间</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样是调用 <code>System.arraycopy()</code> 方法对数组进行复制和移动。</p><p>“三妹，注意看，我画幅图来表示下。”我认真地做起了图。</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraylist-02.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_07、查找-arraylist-中的元素" tabindex="-1"><a class="header-anchor" href="#_07、查找-arraylist-中的元素" aria-hidden="true">#</a> 07、查找 ArrayList 中的元素</h3><p>“二哥，那怎么<strong>查找 ArrayList 中的元素</strong>呢？”三妹继续问。</p><p>如果要正序查找一个元素，可以使用 <code>indexOf()</code> 方法；如果要倒序查找一个元素，可以使用 <code>lastIndexOf()</code> 方法。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>alist<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;沉默王二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
alist<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;沉默王二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>来看一下 <code>indexOf()</code> 方法的源码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 返回指定元素在列表中第一次出现的位置。
 * 如果列表不包含该元素，则返回 -1。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">o</span> 要查找的元素
 * <span class="token keyword">@return</span> 指定元素在列表中第一次出现的位置；如果列表不包含该元素，则返回 -1
 */</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果要查找的元素是 null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 遍历列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果找到了 null 元素</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token comment">// 返回元素的索引</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 如果要查找的元素不是 null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 遍历列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果找到了要查找的元素</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token comment">// 返回元素的索引</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果找不到要查找的元素，则返回 -1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果元素为 null 的时候使用“==”操作符，否则使用 <code>equals()</code> 方法。</p><p><code>lastIndexOf()</code> 方法和 <code>indexOf()</code> 方法类似，不过遍历的时候从最后开始。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 返回指定元素在列表中最后一次出现的位置。
 * 如果列表不包含该元素，则返回 -1。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">o</span> 要查找的元素
 * <span class="token keyword">@return</span> 指定元素在列表中最后一次出现的位置；如果列表不包含该元素，则返回 -1
 */</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果要查找的元素是 null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token comment">// 从后往前遍历列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 如果找到了 null 元素</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token comment">// 返回元素的索引</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 如果要查找的元素不是 null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token comment">// 从后往前遍历列表</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果找到了要查找的元素</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token comment">// 返回元素的索引</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果找不到要查找的元素，则返回 -1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>contains()</code> 方法可以判断 ArrayList 中是否包含某个元素，其内部就是通过 <code>indexOf()</code> 方法实现的：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_08、二分查找法" tabindex="-1"><a class="header-anchor" href="#_08、二分查找法" aria-hidden="true">#</a> 08、二分查找法</h3><p>如果 ArrayList 中的元素是经过排序的，就可以使用二分查找法，效率更快。</p>`,18),g={href:"https://javabetter.cn/common-tool/collections.html",target:"_blank",rel:"noopener noreferrer"},h=n("code",null,"Collections",-1),f=n("code",null,"sort()",-1),w=t(`<p>这里先简单地了解一下，后面会详细地讲。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> copy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>alist<span class="token punctuation">)</span><span class="token punctuation">;</span>
copy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
copy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
copy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
copy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果如下所示：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[a, b, c, d]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>排序后就可以使用二分查找法了：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>copy<span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_09、arraylist增删改查时的时间复杂度" tabindex="-1"><a class="header-anchor" href="#_09、arraylist增删改查时的时间复杂度" aria-hidden="true">#</a> 09、ArrayList增删改查时的时间复杂度</h3><p>“最后，三妹，我们来简单总结一下 ArrayList 的时间复杂度吧，方便后面学习 LinkedList 时对比。”我喝了一口水后补充道。</p><h4 id="_1-查询" tabindex="-1"><a class="header-anchor" href="#_1-查询" aria-hidden="true">#</a> 1）查询</h4><p>时间复杂度为 O(1)，因为 ArrayList 内部使用数组来存储元素，所以可以直接根据索引来访问元素。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 返回列表中指定位置的元素。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> 要返回的元素的索引
 * <span class="token keyword">@return</span> 列表中指定位置的元素
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IndexOutOfBoundsException</span></span> 如果索引超出范围（index &lt; 0 || index &gt;= size()）
 */</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查索引是否合法</span>
    <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 elementData 方法获取元素</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * 返回列表中指定位置的元素。
 * 此方法不进行边界检查，因此只应由内部方法和迭代器调用。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> 要返回的元素的索引
 * <span class="token keyword">@return</span> 列表中指定位置的元素
 */</span>
<span class="token class-name">E</span> <span class="token function">elementData</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 返回指定索引位置上的元素</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-插入" tabindex="-1"><a class="header-anchor" href="#_2-插入" aria-hidden="true">#</a> 2）插入</h4><p>添加一个元素（调用 <code>add()</code> 方法时）的时间复杂度最好情况为 O(1)，最坏情况为 O(n)。</p><ul><li>如果在列表末尾添加元素，时间复杂度为 O(1)。</li><li>如果要在列表的中间或开头插入元素，则需要将插入位置之后的元素全部向后移动一位，时间复杂度为 O(n)。</li></ul><h4 id="_3-删除" tabindex="-1"><a class="header-anchor" href="#_3-删除" aria-hidden="true">#</a> 3）删除</h4><p>删除一个元素（调用 <code>remove(Object)</code> 方法时）的时间复杂度最好情况 O(1)，最坏情况 O(n)。</p><ul><li>如果要删除列表末尾的元素，时间复杂度为 O(1)。</li><li>如果要删除列表中间或开头的元素，则需要将删除位置之后的元素全部向前移动一位，时间复杂度为 O(n)。</li></ul><h4 id="_4-修改" tabindex="-1"><a class="header-anchor" href="#_4-修改" aria-hidden="true">#</a> 4）修改</h4><p>修改一个元素（调用 <code>set()</code>方法时）与查询操作类似，可以直接根据索引来访问元素，时间复杂度为 O(1)。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 用指定元素替换列表中指定位置的元素。
 *
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> 要替换元素的索引
 * <span class="token keyword">@param</span> <span class="token parameter">element</span> 要放入列表中的元素
 * <span class="token keyword">@return</span> 原来在指定位置上的元素
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IndexOutOfBoundsException</span></span> 如果索引超出范围（index &lt; 0 || index &gt;= size()）
 */</span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查索引是否合法</span>

    <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取原来在指定位置上的元素</span>
    elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span> <span class="token comment">// 将指定位置上的元素替换为新元素</span>
    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span> <span class="token comment">// 返回原来在指定位置上的元素</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10、总结" tabindex="-1"><a class="header-anchor" href="#_10、总结" aria-hidden="true">#</a> 10、总结</h3><p>ArrayList，如果有个中文名的话，应该叫动态数组，也就是可增长的数组，可调整大小的数组。动态数组克服了静态数组的限制，静态数组的容量是固定的，只能在首次创建的时候指定。而动态数组会随着元素的增加自动调整大小，更符合实际的开发需求。</p><p>学习集合框架，ArrayList 是第一课，也是新手进阶的重要一课。要想完全掌握 ArrayList，扩容这个机制是必须得掌握，也是面试中经常考察的一个点。</p><p>要想掌握扩容机制，就必须得读源码，也就肯定会遇到 <code>oldCapacity &gt;&gt; 1</code>，有些初学者会选择跳过，虽然不影响整体上的学习，但也错过了一个精进的机会。</p><p>计算机内部是如何表示十进制数的，右移时又发生了什么，静下心来去研究一下，你就会发现，哦，原来这么有趣呢？</p><p>“好了，三妹，这一节我们就学到这里，收工！”</p><hr>`,27),x={href:"https://github.com/itwanger/toBeBetterJavaer",target:"_blank",rel:"noopener noreferrer"},j={href:"https://javabetter.cn/overview/",target:"_blank",rel:"noopener noreferrer"},A=n("p",null,[a("微信搜 "),n("strong",null,"沉默王二"),a(" 或扫描下方二维码关注二哥的原创公众号沉默王二，回复 "),n("strong",null,"222"),a(" 即可免费领取。")],-1),_=n("figure",null,[n("img",{src:"https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png",alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1);function C(L,D){const s=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[d,a("方法会调用到一个非常重要的"),n("a",r,[a("本地方法"),e(s)]),a(),k,a("，它会对数组进行复制（要插入位置上的元素往后复制）。")]),m,n("ul",null,[v,n("li",null,[a("判断两个元素是否相等，可以参考"),n("a",b,[a("Java如何判断两个字符串是否相等"),e(s)])])]),y,n("p",null,[n("a",g,[h,e(s)]),a(" 类的 "),f,a(" 方法可以对 ArrayList 进行排序，该方法会按照字母顺序对 String 类型的列表进行排序。如果是自定义类型的列表，还可以指定 Comparator 进行排序。")]),w,n("p",null,[a("GitHub 上标星 8700+ 的开源知识库《"),n("a",x,[a("二哥的 Java 进阶之路"),e(s)]),a("》第一版 PDF 终于来了！包括Java基础语法、数组&字符串、OOP、集合框架、Java IO、异常处理、Java 新特性、网络编程、NIO、并发编程、JVM等等，共计 32 万余字，可以说是通俗易懂、风趣幽默……详情戳："),n("a",j,[a("太赞了，GitHub 上标星 8700+ 的 Java 教程"),e(s)])]),A,_])}const z=p(l,[["render",C],["__file","arraylist.html.vue"]]);export{z as default};
