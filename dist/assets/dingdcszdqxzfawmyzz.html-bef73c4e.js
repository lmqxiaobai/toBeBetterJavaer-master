import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as l,c as a,a as e,d as n,b as t,e as s}from"./app-1c5b5ce3.js";const p={},c=s('<p>崭新的办公室，崭新的会议室，窗明几净，地毯一尘不染，这样舒适的工作环境，小二不由得期待了起来，要是这次面试能通过，我一定要好好干！</p><p>小二敲敲门，蹑手蹑脚进入了办公室，态度虔诚，弯腰鞠躬，面露微笑，寒暄过后，一切就绪，面试官老王问了这么一个问题。</p><p>“看你简历上写对电商购物比较熟悉，那在下单之后，通常会有一个倒计时，如果超过支付时间，订单就会被自动取消。”</p><figure><img src="https://mmbiz.qpic.cn/mmbiz_png/PMZOEonJxWet6dkExtrdrG1hWr2LicsD4Ny38KlJpVr1x1Jiaia3VewGGAO7XN4Rl8lhw0eDL0bZRlq9JYTadicybQ/640?wx_fmt=png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>“你就来说说，你们项目中，订单超时未支付自动取消都用了哪几种方案？”</p><p>听完老王这句话，小二心里狂喜，前几天才在二哥公众号看到这道面试题，这就碰上了！但小二依然表现出非常淡定的态度，娓娓道来。。。。。</p><blockquote><p>以下是小二之前看到的解决方案，他可以说是倒背如流。</p></blockquote><h2 id="_1-定时任务" tabindex="-1"><a class="header-anchor" href="#_1-定时任务" aria-hidden="true">#</a> 1.定时任务</h2><p>这是最容易想到的办法，定时任务去轮询数据库，取消即将超时的订单。</p><figure><img src="https://mmbiz.qpic.cn/mmbiz_png/PMZOEonJxWet6dkExtrdrG1hWr2LicsD4HnLvHicEQLt8XmsiaJ6FcD9M75QCTANDsr7HfKqYkRCVY8tHNbhwMcuw/640?wx_fmt=png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>定时任务实现方式有很多种，大概可以分为两类：<code>本地定时任务</code>和<code>分布式定时任务</code>。</p><figure><img src="https://mmbiz.qpic.cn/mmbiz_png/PMZOEonJxWet6dkExtrdrG1hWr2LicsD4SicS56Z5N58TQYqamMy2nKubtMSvDOHxmL0rYBkF5rABgE60P6D6v0Q/640?wx_fmt=png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>本地定时任务，适用于单机版的业务系统，实现方式非常多样：</p><ul><li>永动机线程：开启一个线程，通过sleep去完成定时，一些开源中间件的某些定时任务是通过这种方式实现的。</li><li>JDK Timer：JDK提供了Timer API，也提供了很多周期性的方法。</li><li>延迟线程池：JDK还提供了延迟线程池ScheduledExecutorService，API和Timer类似。</li><li>Spring Task：Sprig框架也提供了一些定时任务的实现，使用起来更加简单。</li><li>Quartz：Quartz框架更进一步，提供了可以动态配置的线程池。</li></ul><p>分布式定时任务：适用于分布式的业务系统，主要的实现框架有两种：</p><ul><li>xxl-job：大众点评的许雪里开源的，一款基于MySQL的轻量级分布式定时任务框架。</li><li>elastic-job：当当开发的弹性分布式任务调度系统，功能很强大，相对重一些。</li></ul><p>定时任务实现的优点是开发起来比较简单，但是它也有一些缺点：</p><ul><li>对数据库的压力很大，定时任务造成人为的波峰，执行的时刻数据库的压力会陡增</li><li>计时不准，定时任务做不到非常精确的时间控制，比如半小时订单过期，但是定时任务很难卡准这个点</li></ul><h2 id="_2-被动取消" tabindex="-1"><a class="header-anchor" href="#_2-被动取消" aria-hidden="true">#</a> 2.被动取消</h2><p>在文章开头的那个倒计时器，大家觉得是怎么做的呢？一般是客户端计时+服务端检查。</p><p>什么意思呢？就是这个倒计时由客户端去做，但是客户端定时去服务端检查，修正倒计时的时间。</p><p>那么，这个订单超时自动取消，也可以由客户端去做：</p><ul><li>用户留在收银台的时候，客户端倒计时+主动查询订单状态，服务端每次都去检查一下订单是否超时、剩余时间</li><li>用户每次进入订单相关的页面，查询订单的时候，服务端也检查一下订单是否超时</li></ul><figure><img src="https://mmbiz.qpic.cn/mmbiz_png/PMZOEonJxWet6dkExtrdrG1hWr2LicsD4PMZdwqQIA2VA8QJwbkOv3IAL3GGnKuh8jkBG96zG26QyO5cXfnTic5g/640?wx_fmt=png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这种方式实现起来也比较简单，但是它也有缺点：</p><ul><li>依赖客户端，如果客户端不发起请求，订单可能永远没法过期，一直占用库存</li></ul><p>当然，也可以<code>被动取消</code>+<code>定时任务</code>，通过定时任务去做兜底的操作。</p><h2 id="_3-延时消息" tabindex="-1"><a class="header-anchor" href="#_3-延时消息" aria-hidden="true">#</a> 3.延时消息</h2><p>第三种方案，就是利用延时消息了，可以使用RocketMQ、RabbitMQ、Kafka的延时消息，消息发送后，有一定延时才会投递。</p><figure><img src="https://mmbiz.qpic.cn/mmbiz_png/PMZOEonJxWet6dkExtrdrG1hWr2LicsD4psG3CspMFIjcX7ShEG6SvNiaqI4LJ9LV7ElrFsWE9sWfZXZrjnBE6OA/640?wx_fmt=png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>我们用的就是这种，消息队列采用的是RocketMQ，其实RocketMQ延时也是利用定时任务实现的。</p><p>使用延时消息的优点是比较高效、好扩展，缺点是引入了新的技术组件，增加了复杂度。</p><h2 id="_4-其他方案" tabindex="-1"><a class="header-anchor" href="#_4-其他方案" aria-hidden="true">#</a> 4.其他方案</h2><p>除了上面的三种，其实还有一些其它的方式，例如本地延迟队列、时间轮算法、Redis过期监听……</p><p>但是我觉得，应该不会有人真考虑过在生产上使用这些方法。</p><p>后记：</p><blockquote><p>时光飞逝，转眼就来到了 2023年03月09 日，这已经是小二入职新公司的第二个年头，公司熬过了去年的寒冬后，就像如今的天气一下，春暖花开，一切重回正轨，蒸蒸日上了起来。小二的学习劲头也更足了些：“今年，我一定要更上一层楼才好呢！”</p></blockquote><h2 id="ending" tabindex="-1"><a class="header-anchor" href="#ending" aria-hidden="true">#</a> ending</h2>',38),h={href:"https://mp.weixin.qq.com/s/hXXBTPPkFj2VMg_GXqn4EA",target:"_blank",rel:"noopener noreferrer"},d=e("strong",null,"1900 多名",-1),_={href:"https://mp.weixin.qq.com/s/hXXBTPPkFj2VMg_GXqn4EA",target:"_blank",rel:"noopener noreferrer"},g=e("strong",null,"编程学习指南 + Java项目实战 + LeetCode刷题的私密圈子",-1),f={href:"https://mp.weixin.qq.com/s/CljCSezUgoBXb-T9wbIGww",target:"_blank",rel:"noopener noreferrer"},m=e("strong",null,"相信能帮助你走的更快、更稳、更远",-1),u=e("figure",null,[e("img",{src:"https://files.mdnice.com/user/3903/0e8c9227-6986-4499-8243-e7e082aa811d.png",alt:"",tabindex:"0",loading:"lazy"}),e("figcaption")],-1),b=e("p",null,"下面 👇🏻 是二哥近期分享的一些原创内容，有在校学生党的，也有在职工作党的，多看看这些掏心掏肺的经验心得，应该会对你以后的校招&求职或者工作学习有很大的帮助 🤔。",-1),q={href:"https://mp.weixin.qq.com/s/_LHMpHlbSGXQfWfR_JtgMA",target:"_blank",rel:"noopener noreferrer"},x={href:"https://mp.weixin.qq.com/s/GtqMTkNKAWRUweVahK_lEg",target:"_blank",rel:"noopener noreferrer"},k={href:"https://mp.weixin.qq.com/s/hOokRylxOXFb76_cF_RBOQ",target:"_blank",rel:"noopener noreferrer"},w={href:"https://mp.weixin.qq.com/s/XPuckTbjGbzIaU8BWTqmFQ",target:"_blank",rel:"noopener noreferrer"},z={href:"https://mp.weixin.qq.com/s/NZFD1DqKWe9aowcjSuBnCQ",target:"_blank",rel:"noopener noreferrer"},E={href:"https://mp.weixin.qq.com/s/v-ID6zBaghSGYsvJgU7Dww",target:"_blank",rel:"noopener noreferrer"},M={href:"https://mp.weixin.qq.com/s/J1O21WNFFoqX5el5nJMV4g",target:"_blank",rel:"noopener noreferrer"},Q={href:"https://mp.weixin.qq.com/s/ywJ0v_BG32HeJ3NpkTvk2w",target:"_blank",rel:"noopener noreferrer"},G={href:"https://mp.weixin.qq.com/s/p9UPga_d1-YsQ9zGlwq2MA",target:"_blank",rel:"noopener noreferrer"},J={href:"https://mp.weixin.qq.com/s/LCvq8ml6EdmQrRBU9ekkwg",target:"_blank",rel:"noopener noreferrer"},D={href:"https://mp.weixin.qq.com/s/BfFhAPvbPpDTRvRTHxa68Q",target:"_blank",rel:"noopener noreferrer"},v={href:"https://mp.weixin.qq.com/s/fktSieMDJUq2rTsEil60sg",target:"_blank",rel:"noopener noreferrer"},B={href:"https://mp.weixin.qq.com/s/MHvjhlQ2PvKaa8SZCGeoag",target:"_blank",rel:"noopener noreferrer"},L={href:"https://mp.weixin.qq.com/s/pIuBh2EH5wrsQ3nLg4-H2Q",target:"_blank",rel:"noopener noreferrer"},T=e("p",null,[n("最后，把二哥的座右铭送给大家："),e("strong",null,"没有什么使我停留——除了目的，纵然岸旁有玫瑰、有绿荫、有宁静的港湾，我是不系之舟"),n("。共勉 💪。")],-1),P=e("figure",null,[e("img",{src:"https://files.mdnice.com/user/3903/b7e50cf4-6fca-4511-9bfd-aa1ed9eb587b.png",alt:"",tabindex:"0",loading:"lazy"}),e("figcaption")],-1),S=e("p",null,[n("欢迎点击左下角"),e("strong",null,"阅读原文"),n("了解二哥的编程星球详情，这可能是你学习求职路上最有含金量的一次点击。")],-1);function W(y,X){const r=o("ExternalLinkIcon");return l(),a("div",null,[c,e("p",null,[n("一个人可以走得很快，但一群人才能走得更远。"),e("a",h,[n("二哥的编程星球"),t(r)]),n("已经有 "),d,n(" 球友加入了，如果你也需要一个良好的学习环境，"),e("a",_,[n("戳链接 🔗"),t(r)]),n("加入我们吧。这是一个"),g,n("，你可以阅读星球专栏、向二哥提问、帮你制定学习计划、和球友一起打卡成长。")]),e("p",null,[e("a",f,[n("星球的知识图谱"),t(r)]),n("里已经沉淀了非常多优质的内容，"),m,n("。")]),u,b,e("ul",null,[e("li",null,[n("✌️："),e("a",q,[n("去B站实习了"),t(r)])]),e("li",null,[n("✌️："),e("a",x,[n("今天正式邮件 offer 下来了！"),t(r)])]),e("li",null,[n("✌️："),e("a",k,[n("还是决定去华为了"),t(r)])]),e("li",null,[n("✌️："),e("a",w,[n("现在醒悟，还能抢救"),t(r)])]),e("li",null,[n("✌️："),e("a",z,[n("冲大厂秋招的一些良心建议"),t(r)])]),e("li",null,[n("✌️："),e("a",E,[n("华为 OD 29 万，心动！"),t(r)])]),e("li",null,[n("✌️："),e("a",M,[n("入职第一天，就想跑路了？"),t(r)])]),e("li",null,[n("✌️："),e("a",Q,[n("官宣：技术派上线了哈～"),t(r)])]),e("li",null,[n("✌️："),e("a",G,[n("国企这情况，，辞职去北京"),t(r)])]),e("li",null,[n("✌️："),e("a",J,[n("想去外企，该如何准备？"),t(r)])]),e("li",null,[n("✌️："),e("a",D,[n("教练，我想学编程！"),t(r)])]),e("li",null,[n("✌️："),e("a",v,[n("抓紧时间准备春招了！"),t(r)])]),e("li",null,[n("✌️："),e("a",B,[n("双非大二，冲 Google"),t(r)])]),e("li",null,[n("✌️："),e("a",L,[n("想跳槽，我该如何准备？"),t(r)])])]),T,P,S])}const R=i(p,[["render",W],["__file","dingdcszdqxzfawmyzz.html.vue"]]);export{R as default};
